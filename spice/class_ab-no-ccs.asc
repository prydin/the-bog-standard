Version 4
SHEET 1 3812 1016
WIRE -16 -880 -640 -880
WIRE 112 -880 -16 -880
WIRE 368 -880 112 -880
WIRE 544 -880 368 -880
WIRE 752 -880 544 -880
WIRE 1152 -880 752 -880
WIRE 1632 -880 1152 -880
WIRE 1872 -880 1632 -880
WIRE 112 -832 112 -880
WIRE 752 -832 752 -880
WIRE -16 -800 -16 -880
WIRE 544 -768 544 -880
WIRE 1152 -768 1152 -880
WIRE -1024 -736 -1024 -768
WIRE -880 -736 -1024 -736
WIRE -848 -736 -880 -736
WIRE -752 -736 -768 -736
WIRE 752 -720 752 -752
WIRE 752 -720 608 -720
WIRE 1088 -720 1056 -720
WIRE 1632 -720 1632 -880
WIRE -16 -688 -16 -736
WIRE 112 -688 112 -752
WIRE 112 -688 -16 -688
WIRE 752 -688 752 -720
WIRE 112 -640 112 -688
WIRE 544 -640 544 -672
WIRE 688 -640 544 -640
WIRE 1152 -640 1152 -672
WIRE 1280 -640 1152 -640
WIRE 1328 -640 1280 -640
WIRE 1456 -640 1408 -640
WIRE 1584 -640 1456 -640
WIRE 544 -592 544 -640
WIRE 368 -576 368 -880
WIRE -1024 -544 -1024 -736
WIRE -880 -544 -880 -736
WIRE -752 -544 -752 -736
WIRE 1456 -544 1456 -640
WIRE 752 -496 752 -592
WIRE 944 -496 752 -496
WIRE 1056 -496 1056 -720
WIRE 1056 -496 944 -496
WIRE 112 -432 112 -560
WIRE 112 -432 -16 -432
WIRE 224 -432 112 -432
WIRE 368 -432 368 -512
WIRE 544 -432 544 -512
WIRE 544 -432 368 -432
WIRE 944 -432 944 -496
WIRE 544 -416 544 -432
WIRE -1024 -384 -1024 -464
WIRE -880 -384 -880 -480
WIRE -880 -384 -1024 -384
WIRE -848 -384 -880 -384
WIRE -752 -384 -752 -480
WIRE -752 -384 -848 -384
WIRE -848 -352 -848 -384
WIRE 944 -336 944 -368
WIRE 1456 -336 1456 -480
WIRE -1024 -304 -1024 -384
WIRE 544 -288 544 -336
WIRE -880 -272 -880 -384
WIRE -752 -272 -752 -384
WIRE -544 -272 -560 -272
WIRE -448 -272 -464 -272
WIRE -16 -224 -16 -432
WIRE 224 -224 224 -432
WIRE -1024 -176 -1024 -224
WIRE -880 -176 -880 -208
WIRE -880 -176 -1024 -176
WIRE -848 -176 -880 -176
WIRE -752 -176 -752 -208
WIRE -752 -176 -768 -176
WIRE -560 -176 -560 -272
WIRE -560 -176 -608 -176
WIRE -544 -176 -560 -176
WIRE -448 -176 -448 -272
WIRE -448 -176 -480 -176
WIRE -432 -176 -448 -176
WIRE -272 -176 -352 -176
WIRE -160 -176 -272 -176
WIRE -112 -176 -160 -176
WIRE -80 -176 -112 -176
WIRE 320 -176 288 -176
WIRE 400 -176 320 -176
WIRE 496 -176 480 -176
WIRE 528 -176 496 -176
WIRE 576 -176 528 -176
WIRE 1456 -176 1456 -272
WIRE 1456 -176 656 -176
WIRE 1632 -176 1632 -624
WIRE 1632 -176 1456 -176
WIRE 1840 -176 1632 -176
WIRE 2000 -176 1840 -176
WIRE 2208 -176 2000 -176
WIRE -1024 -160 -1024 -176
WIRE 752 -128 752 -496
WIRE 752 -128 640 -128
WIRE 864 -128 752 -128
WIRE 1840 -128 1840 -176
WIRE 464 -112 352 -112
WIRE 528 -112 528 -176
WIRE 528 -112 464 -112
WIRE 640 -112 640 -128
WIRE -160 -96 -160 -176
WIRE -112 -96 -112 -176
WIRE 96 -96 -112 -96
WIRE 160 -96 144 -96
WIRE 320 -96 320 -176
WIRE 320 -96 160 -96
WIRE 352 -96 352 -112
WIRE 2000 -96 2000 -176
WIRE -272 -80 -272 -176
WIRE 464 -80 464 -112
WIRE 528 -80 528 -112
WIRE 1152 -64 1152 -640
WIRE 1280 -64 1280 -640
WIRE 1456 -64 1456 -176
WIRE 752 -48 752 -128
WIRE 864 -32 864 -128
WIRE 1840 -16 1840 -64
WIRE 2128 -16 2128 -64
WIRE 2352 -16 2128 -16
WIRE 2544 -16 2432 -16
WIRE 2672 -16 2544 -16
WIRE 2784 -16 2672 -16
WIRE 96 0 96 -96
WIRE 160 0 160 -96
WIRE 352 0 352 -16
WIRE 464 0 464 -16
WIRE 464 0 352 0
WIRE 528 0 528 -16
WIRE 528 0 464 0
WIRE 640 0 640 -32
WIRE 688 0 640 0
WIRE 2544 0 2544 -16
WIRE 2672 0 2672 -16
WIRE 2784 0 2784 -16
WIRE -272 48 -272 -16
WIRE -160 48 -160 -16
WIRE -160 48 -272 48
WIRE 640 48 640 0
WIRE 528 96 528 80
WIRE 1840 96 1840 64
WIRE 2000 96 2000 -16
WIRE -272 112 -272 48
WIRE -16 112 -16 -128
WIRE 336 112 -16 112
WIRE 2544 112 2544 64
WIRE 2672 112 2672 80
WIRE 2672 112 2544 112
WIRE 2784 112 2784 80
WIRE 2784 112 2672 112
WIRE 640 144 640 128
WIRE 752 144 752 48
WIRE 752 144 640 144
WIRE 864 144 864 32
WIRE 864 144 752 144
WIRE 1456 144 1456 0
WIRE 2544 144 2544 112
WIRE -1216 160 -1216 96
WIRE -1680 224 -1680 96
WIRE -928 224 -928 96
WIRE 592 240 480 240
WIRE 752 240 752 144
WIRE 752 240 656 240
WIRE 224 304 224 -128
WIRE 224 304 112 304
WIRE 608 336 608 304
WIRE -16 352 -16 112
WIRE 224 352 224 304
WIRE -1680 368 -1680 304
WIRE 1632 368 1632 -176
WIRE 336 384 336 112
WIRE 480 384 480 240
WIRE 480 384 336 384
WIRE 544 384 480 384
WIRE 752 384 752 240
WIRE 944 384 752 384
WIRE 1056 384 944 384
WIRE 1152 384 1152 16
WIRE 1280 384 1280 0
WIRE 1280 384 1152 384
WIRE 1328 384 1280 384
WIRE 1456 384 1456 208
WIRE 1456 384 1408 384
WIRE 1584 384 1456 384
WIRE 2032 384 2000 384
WIRE 2048 384 2032 384
WIRE 2224 384 2128 384
WIRE 112 400 112 304
WIRE 112 400 48 400
WIRE 160 400 112 400
WIRE 752 416 752 384
WIRE 2032 416 2032 384
WIRE -1216 432 -1216 240
WIRE -928 432 -928 304
WIRE -928 432 -1216 432
WIRE 944 432 944 384
WIRE -1216 464 -1216 432
WIRE 608 464 608 432
WIRE 688 464 608 464
WIRE 1920 464 1920 384
WIRE 1920 464 1776 464
WIRE 480 496 480 384
WIRE 1152 496 1152 384
WIRE 2032 512 2032 480
WIRE -16 544 -16 448
WIRE 224 544 224 448
WIRE 752 544 752 512
WIRE 752 544 544 544
WIRE 1056 544 1056 384
WIRE 1088 544 1056 544
WIRE 752 560 752 544
WIRE 944 560 944 496
WIRE 1920 576 1920 464
WIRE 2032 576 1984 576
WIRE 2096 576 2032 576
WIRE 2224 576 2224 384
WIRE 2224 576 2160 576
WIRE 608 608 608 464
WIRE 2032 640 2032 576
WIRE -16 704 -16 624
WIRE -16 704 -640 704
WIRE 224 704 224 624
WIRE 224 704 -16 704
WIRE 480 704 480 592
WIRE 480 704 224 704
WIRE 608 704 608 688
WIRE 608 704 480 704
WIRE 752 704 752 640
WIRE 752 704 608 704
WIRE 1152 704 1152 592
WIRE 1152 704 752 704
WIRE 1632 704 1632 464
WIRE 1632 704 1152 704
WIRE 2032 768 2032 720
FLAG 528 96 0
FLAG -608 -176 IN
FLAG -928 96 IN
FLAG -640 704 B-
FLAG -640 -880 B+
FLAG -848 -352 0
FLAG -1024 -768 B+
FLAG -1024 -160 B-
FLAG 2208 -176 OUT
FLAG 320 -176 NEG_IN
FLAG 496 -176 FB
FLAG 1840 96 0
FLAG 2032 512 0
FLAG 2032 768 0
FLAG -1216 464 0
FLAG 944 560 0
FLAG 944 -336 0
FLAG -1680 368 0
FLAG -1216 96 SINE
FLAG -1680 96 SQR
FLAG 608 304 0
FLAG -272 112 0
FLAG 2544 144 0
FLAG 544 -288 0
FLAG 2000 96 0
SYMBOL voltage -1024 -320 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR SpiceLine Rser=1
SYMATTR InstName V3
SYMATTR Value 40
SYMBOL res 672 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 22k
SYMBOL res 512 -16 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL cap 512 -80 R0
SYMATTR InstName C4
SYMATTR Value 220µ
SYMBOL res -176 -112 R0
SYMATTR InstName R2
SYMATTR Value 22k
SYMBOL cap -288 -80 R0
SYMATTR InstName C2
SYMATTR Value 220p
SYMBOL res -336 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 150
SYMBOL cap 656 224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 47p
SYMBOL npn 688 -48 R0
SYMATTR InstName Q7
SYMATTR Value BD139C
SYMBOL res 624 -128 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL res 624 32 R0
SYMATTR InstName R12
SYMATTR Value 865
SYMBOL cap 1824 -128 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL res 1824 -32 R0
SYMATTR InstName R20
SYMATTR Value 10
SYMBOL voltage -1024 -560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR SpiceLine Rser=1
SYMATTR InstName V1
SYMATTR Value 40
SYMBOL cap 848 -32 R0
SYMATTR InstName C6
SYMATTR Value 10µ
SYMBOL voltage -1216 144 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC 0
SYMATTR InstName V5
SYMATTR Value SINE(0 {a} {f})
SYMBOL res 2016 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 2k
SYMBOL res 2144 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 2k
SYMBOL cap 2016 416 R0
SYMATTR InstName C7
SYMATTR Value 159.2n
SYMBOL cap 1920 592 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C8
SYMATTR Value 79.62n
SYMBOL cap 2096 592 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C9
SYMATTR Value 79.62n
SYMBOL res 2016 624 R0
SYMATTR InstName R28
SYMATTR Value 1k
SYMBOL nmos 1584 -720 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL pmos 1584 464 M180
SYMATTR InstName M2
SYMATTR Value IRFP9240
SYMBOL res 1424 -656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 56
SYMBOL res 1424 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R32
SYMATTR Value 56
SYMBOL diode 1440 -336 R0
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL zener 1472 -480 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value UMZ5_1N
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL zener 1440 0 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMATTR Value UMZ5_1N
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL diode 1472 144 M0
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL cap -896 -544 R0
SYMATTR InstName C10
SYMATTR Value 7m
SYMBOL cap -896 -272 R0
SYMATTR InstName C12
SYMATTR Value 7m
SYMBOL cap -480 -192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 4.7µ
SYMBOL npn 1088 -768 R0
SYMATTR InstName Q5
SYMATTR Value BD139C
SYMBOL pnp 1088 592 M180
SYMATTR InstName Q9
SYMATTR Value BD140C
SYMBOL res 1136 -80 R0
SYMATTR InstName R25
SYMATTR Value 680
SYMBOL cap 1264 -64 R0
SYMATTR InstName C11
SYMATTR Value 220n
SYMBOL cap 928 432 R0
SYMATTR InstName C13
SYMATTR Value 47p
SYMBOL cap 928 -432 R0
SYMATTR InstName C14
SYMATTR Value 47p
SYMBOL bv -1680 208 R0
SYMATTR InstName B1
SYMATTR Value v=if(time>1e-6,{a}*sgn(v(sine)),0)
SYMBOL bv -928 208 R0
SYMATTR InstName B2
SYMATTR Value V=if({square}>0,v(sqr),v(sine))
SYMBOL npn 688 416 R0
SYMATTR InstName Q10
SYMATTR Value BD139C
SYMBOL npn 544 336 R0
SYMATTR InstName Q13
SYMATTR Value 2N5550
SYMBOL res 736 544 R0
SYMATTR InstName R16
SYMATTR Value 22
SYMBOL res 592 592 R0
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL diode 480 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL pnp 688 -592 M180
SYMATTR InstName Q6
SYMATTR Value BD140C
SYMBOL res 736 -848 R0
SYMATTR InstName R10
SYMATTR Value 50
SYMBOL pnp 608 -672 R180
SYMATTR InstName Q14
SYMATTR Value 2N5401
SYMBOL res 528 -608 R0
SYMATTR InstName R19
SYMATTR Value 5k
SYMBOL npn 160 352 R0
SYMATTR InstName Q8
SYMATTR Value 2N5550
SYMBOL npn 48 352 M0
SYMATTR InstName Q12
SYMATTR Value 2N5550
SYMBOL res -32 528 R0
SYMATTR InstName R13
SYMATTR Value 100
SYMBOL res 208 528 R0
SYMATTR InstName R14
SYMATTR Value 100
SYMBOL res 96 -848 R0
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL pnp 288 -128 R180
SYMATTR InstName Q1
SYMATTR Value 2N5401
SYMBOL pnp -80 -128 M180
SYMATTR InstName Q2
SYMATTR Value 2N5401
SYMBOL res -448 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value {dc_couple_res}
SYMBOL res 368 0 R180
WINDOW 0 36 76 Left 2
WINDOW 3 -80 -14 Left 2
SYMATTR InstName R6
SYMATTR Value {dc_couple_res}
SYMBOL res 2112 -160 R0
SYMATTR InstName R15
SYMATTR Value 6.8
SYMBOL ind 2336 0 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value 1m
SYMBOL cap 2528 0 R0
SYMATTR InstName C15
SYMATTR Value 500µ
SYMBOL ind 2656 -16 R0
SYMATTR InstName L4
SYMATTR Value 20m
SYMBOL res 2768 -16 R0
SYMATTR InstName R22
SYMATTR Value 22
SYMBOL voltage 496 -176 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 25 49 VBottom 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value ""
SYMATTR Value2 AC 1
SYMBOL npn 544 496 M0
SYMATTR InstName Q11
SYMATTR Value 2N5550
SYMBOL res 528 -432 R0
SYMATTR InstName R27
SYMATTR Value 5k
SYMBOL res 1984 -112 R0
SYMATTR InstName R30
SYMATTR Value 8
SYMBOL cap 352 -576 R0
SYMATTR InstName C17
SYMATTR Value 10µ
SYMBOL diode 160 -112 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL diode 96 16 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D7
SYMATTR Value 1N4148
SYMBOL cap -768 -544 R0
SYMATTR InstName C18
SYMATTR Value 200µ
SYMBOL cap -768 -272 R0
SYMATTR InstName C19
SYMATTR Value 200µ
SYMBOL res -752 -752 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value 1
SYMBOL res -752 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 1
SYMBOL res 96 -656 R0
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL cap -32 -800 R0
SYMATTR InstName C16
SYMATTR Value 4.7µ
TEXT -352 800 Left 2 !.param f=1k a=0.8 square=0 sim_time=100m delay=0 dc_coupled=1\n.param dc_couple_res=if({dc_coupled}>0,1p,10G)\n;.tran 0 {sim_time+delay} {delay} 100n\n.four {f} 50 -1 v(out)\n.option plotwinsize=0 NoOpiter numdgt=15\n;  .step param prb list -1 1
TEXT -344 752 Left 2 !.ac dec 1000 1 10meg
TEXT -344 976 Left 2 ;.noise out in dec 1000 1 1meg
TEXT 1896 280 Left 2 ;Notch filter for time domain distortion test
TEXT 520 800 Left 2 ;f - Input frequency\na - Input amplitude\nsquare - Set to non-zero for square wave input\nsim_time - Simulation time (not counting settling delay)\ndelay - Settling delay. Set to several seconds for accurate THD\ndc_coupled = Shorts high value capacitors to allow for quick THD checks
