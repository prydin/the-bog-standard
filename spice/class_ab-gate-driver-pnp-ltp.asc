Version 4
SHEET 1 3812 1016
WIRE 1056 -976 848 -976
WIRE 112 -880 -96 -880
WIRE 544 -880 112 -880
WIRE 752 -880 544 -880
WIRE 848 -880 848 -976
WIRE 848 -880 752 -880
WIRE 928 -880 848 -880
WIRE 1056 -880 1056 -976
WIRE 1056 -880 1008 -880
WIRE 1152 -880 1056 -880
WIRE 1808 -880 1152 -880
WIRE 2048 -880 1808 -880
WIRE 1056 -864 1056 -880
WIRE 112 -832 112 -880
WIRE 752 -832 752 -880
WIRE -96 -768 -96 -880
WIRE 544 -768 544 -880
WIRE 1152 -768 1152 -880
WIRE -1024 -736 -1024 -768
WIRE -880 -736 -1024 -736
WIRE 112 -720 112 -752
WIRE 112 -720 -32 -720
WIRE 752 -720 752 -752
WIRE 752 -720 608 -720
WIRE 1088 -720 1056 -720
WIRE 1808 -720 1808 -880
WIRE 112 -688 112 -720
WIRE 752 -688 752 -720
WIRE -96 -640 -96 -672
WIRE 48 -640 -96 -640
WIRE 544 -640 544 -672
WIRE 688 -640 544 -640
WIRE 1152 -640 1152 -672
WIRE 1280 -640 1152 -640
WIRE 1456 -640 1280 -640
WIRE 1584 -640 1456 -640
WIRE 1760 -640 1664 -640
WIRE -96 -592 -96 -640
WIRE 544 -592 544 -640
WIRE -1024 -544 -1024 -736
WIRE -880 -544 -880 -736
WIRE 1456 -544 1456 -640
WIRE 752 -496 752 -592
WIRE 944 -496 752 -496
WIRE 1056 -496 1056 -720
WIRE 1056 -496 944 -496
WIRE -96 -464 -96 -512
WIRE 544 -464 544 -512
WIRE 0 -432 -16 -432
WIRE 112 -432 112 -592
WIRE 112 -432 80 -432
WIRE 128 -432 112 -432
WIRE 224 -432 208 -432
WIRE 944 -432 944 -496
WIRE 1808 -432 1808 -624
WIRE -1024 -384 -1024 -464
WIRE -880 -384 -880 -480
WIRE -880 -384 -1024 -384
WIRE -848 -384 -880 -384
WIRE -848 -352 -848 -384
WIRE 944 -336 944 -368
WIRE 1456 -336 1456 -480
WIRE -1024 -304 -1024 -384
WIRE 2192 -288 2160 -288
WIRE 2304 -288 2272 -288
WIRE -880 -272 -880 -384
WIRE -448 -240 -560 -240
WIRE -16 -224 -16 -432
WIRE 224 -224 224 -432
WIRE -1024 -176 -1024 -224
WIRE -880 -176 -880 -208
WIRE -880 -176 -1024 -176
WIRE -560 -176 -560 -240
WIRE -560 -176 -608 -176
WIRE -544 -176 -560 -176
WIRE -448 -176 -448 -240
WIRE -448 -176 -480 -176
WIRE -432 -176 -448 -176
WIRE -272 -176 -352 -176
WIRE -160 -176 -272 -176
WIRE -80 -176 -160 -176
WIRE 320 -176 288 -176
WIRE 400 -176 320 -176
WIRE 496 -176 480 -176
WIRE 528 -176 496 -176
WIRE 576 -176 528 -176
WIRE 1456 -176 1456 -272
WIRE 1456 -176 656 -176
WIRE 1808 -176 1808 -352
WIRE 1808 -176 1456 -176
WIRE 2016 -176 1808 -176
WIRE 2160 -176 2160 -288
WIRE 2160 -176 2016 -176
WIRE 2192 -176 2160 -176
WIRE 2304 -176 2304 -288
WIRE 2304 -176 2272 -176
WIRE 2464 -176 2304 -176
WIRE 2544 -176 2464 -176
WIRE 2848 -176 2816 -176
WIRE 2864 -176 2848 -176
WIRE 3040 -176 2944 -176
WIRE -1024 -160 -1024 -176
WIRE 2464 -144 2464 -176
WIRE 2544 -144 2464 -144
WIRE 2848 -144 2848 -176
WIRE 752 -128 752 -496
WIRE 752 -128 640 -128
WIRE 864 -128 752 -128
WIRE 2016 -128 2016 -176
WIRE 464 -112 352 -112
WIRE 528 -112 528 -176
WIRE 528 -112 464 -112
WIRE 640 -112 640 -128
WIRE 2464 -112 2464 -144
WIRE -160 -96 -160 -176
WIRE -272 -80 -272 -176
WIRE 464 -80 464 -112
WIRE 528 -80 528 -112
WIRE 1152 -64 1152 -640
WIRE 1280 -64 1280 -640
WIRE 1456 -64 1456 -176
WIRE 752 -48 752 -128
WIRE 2848 -48 2848 -80
WIRE 864 -32 864 -128
WIRE 2016 -16 2016 -64
WIRE 352 0 352 -112
WIRE 464 0 464 -16
WIRE 464 0 352 0
WIRE 528 0 528 -16
WIRE 528 0 464 0
WIRE 640 0 640 -32
WIRE 688 0 640 0
WIRE 2464 16 2464 -32
WIRE 2544 16 2544 -144
WIRE 2544 16 2464 16
WIRE 2736 16 2736 -176
WIRE 2848 16 2800 16
WIRE 2912 16 2848 16
WIRE 3040 16 3040 -176
WIRE 3040 16 2976 16
WIRE -272 48 -272 -16
WIRE -160 48 -160 -16
WIRE -160 48 -272 48
WIRE 640 48 640 0
WIRE 2464 48 2464 16
WIRE 2848 80 2848 16
WIRE 528 96 528 80
WIRE 1808 96 1808 -176
WIRE 2016 96 2016 64
WIRE -272 112 -272 48
WIRE -16 112 -16 -128
WIRE 336 112 -16 112
WIRE 640 144 640 128
WIRE 752 144 752 48
WIRE 752 144 640 144
WIRE 864 144 864 32
WIRE 864 144 752 144
WIRE 1456 144 1456 0
WIRE -1040 176 -1040 48
WIRE -768 176 -768 48
WIRE 592 192 496 192
WIRE 752 192 752 144
WIRE 752 192 656 192
WIRE 2464 192 2464 128
WIRE 2848 208 2848 160
WIRE 224 304 224 -128
WIRE 224 304 112 304
WIRE 608 336 608 304
WIRE -16 352 -16 112
WIRE 224 352 224 304
WIRE 1808 368 1808 176
WIRE -1040 384 -1040 256
WIRE -768 384 -768 256
WIRE -768 384 -1040 384
WIRE 336 384 336 112
WIRE 496 384 496 192
WIRE 496 384 336 384
WIRE 544 384 496 384
WIRE 752 384 752 192
WIRE 944 384 752 384
WIRE 1056 384 944 384
WIRE 1152 384 1152 16
WIRE 1280 384 1280 0
WIRE 1280 384 1152 384
WIRE 1456 384 1456 208
WIRE 1456 384 1280 384
WIRE 1584 384 1456 384
WIRE 1760 384 1664 384
WIRE 112 400 112 304
WIRE 112 400 48 400
WIRE 160 400 112 400
WIRE -1040 416 -1040 384
WIRE 752 416 752 384
WIRE 944 432 944 384
WIRE 608 464 608 432
WIRE 688 464 608 464
WIRE 1152 496 1152 384
WIRE 608 512 608 464
WIRE -16 544 -16 448
WIRE 224 544 224 448
WIRE 752 544 752 512
WIRE 752 544 688 544
WIRE 1056 544 1056 384
WIRE 1088 544 1056 544
WIRE 752 560 752 544
WIRE 944 560 944 496
WIRE 496 576 496 384
WIRE 688 624 688 544
WIRE 688 624 560 624
WIRE -928 656 -928 528
WIRE -16 704 -16 624
WIRE 224 704 224 624
WIRE 224 704 -16 704
WIRE 496 704 496 672
WIRE 496 704 224 704
WIRE 608 704 608 592
WIRE 608 704 496 704
WIRE 752 704 752 640
WIRE 752 704 608 704
WIRE 848 704 752 704
WIRE 896 704 848 704
WIRE 1008 704 976 704
WIRE 1152 704 1152 592
WIRE 1152 704 1008 704
WIRE 1808 704 1808 464
WIRE 1808 704 1152 704
WIRE 2064 704 1808 704
WIRE -928 800 -928 736
WIRE 848 800 848 704
WIRE 1008 800 1008 704
WIRE 1008 800 848 800
FLAG 528 96 0
FLAG -608 -176 IN
FLAG -768 48 IN
FLAG 2064 704 B-
FLAG 2048 -880 B+
FLAG -848 -352 0
FLAG -1024 -768 B+
FLAG -1024 -160 B-
FLAG 2544 -176 OUT
FLAG 320 -176 NEG_IN
FLAG 496 -176 FB
FLAG 2016 96 0
FLAG 2848 -48 0
FLAG 2848 208 0
FLAG 2464 192 0
FLAG -1040 416 0
FLAG 944 560 0
FLAG 944 -336 0
FLAG -928 800 0
FLAG -1040 48 SINE
FLAG -928 528 SQR
FLAG 608 304 0
FLAG 544 -464 0
FLAG -272 112 0
FLAG -96 -464 0
SYMBOL voltage -1024 -320 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR InstName V3
SYMATTR Value 40
SYMBOL res 672 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 22k
SYMBOL res 512 -16 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL cap 512 -80 R0
SYMATTR InstName C4
SYMATTR Value 220µ
SYMBOL res -176 -112 R0
SYMATTR InstName R2
SYMATTR Value 22k
SYMBOL cap -288 -80 R0
SYMATTR InstName C2
SYMATTR Value 68p
SYMBOL res -336 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 150
SYMBOL cap 656 176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 33p
SYMBOL npn 688 -48 R0
SYMATTR InstName Q7
SYMATTR Value BD139C
SYMBOL res 624 -128 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL res 624 32 R0
SYMATTR InstName R12
SYMATTR Value 865
SYMBOL cap 2000 -128 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL res 2000 -32 R0
SYMATTR InstName R20
SYMATTR Value 10
SYMBOL voltage 496 -176 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 -4 56 VBottom 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value ""
SYMATTR Value2 AC 0
SYMBOL voltage -1024 -560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR InstName V1
SYMATTR Value 40
SYMBOL cap 848 -32 R0
SYMATTR InstName C6
SYMATTR Value 47µ
SYMBOL voltage -1040 160 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
WINDOW 3 24 103 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V5
SYMATTR Value SINE(0 {a} {f})
SYMBOL res 2832 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 2k
SYMBOL res 2960 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 2k
SYMBOL cap 2832 -144 R0
SYMATTR InstName C7
SYMATTR Value 159.2n
SYMBOL cap 2736 32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C8
SYMATTR Value 79.62n
SYMBOL cap 2912 32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C9
SYMATTR Value 79.62n
SYMBOL res 2832 64 R0
SYMATTR InstName R28
SYMATTR Value 1k
SYMBOL ind 2448 -128 R0
SYMATTR InstName L3
SYMATTR Value 1m
SYMBOL res 2448 32 R0
SYMATTR InstName R31
SYMATTR Value 8
SYMBOL nmos 1760 -720 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL pmos 1760 464 M180
SYMATTR InstName M2
SYMATTR Value IRFP9240
SYMBOL res 1680 -656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 47
SYMBOL res 1680 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R32
SYMATTR Value 47
SYMBOL diode 1440 -336 R0
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL zener 1472 -480 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value UFZV8_2B
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL zener 1440 0 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMATTR Value UFZV8_2B
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL diode 1472 144 M0
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL res 2288 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 10
SYMBOL ind 2176 -272 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 3µ
SYMBOL cap -896 -544 R0
SYMATTR InstName C10
SYMATTR Value 7m
SYMBOL cap -896 -272 R0
SYMATTR InstName C12
SYMATTR Value 7m
SYMBOL cap -480 -192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 4.7µ
SYMBOL npn 1088 -768 R0
SYMATTR InstName Q5
SYMATTR Value BD139C
SYMBOL pnp 1088 592 M180
SYMATTR InstName Q9
SYMATTR Value BD140C
SYMBOL res 1136 -80 R0
SYMATTR InstName R25
SYMATTR Value 680
SYMBOL cap 1264 -64 R0
SYMATTR InstName C11
SYMATTR Value 220n
SYMBOL cap 928 432 R0
SYMATTR InstName C13
SYMATTR Value 68p
SYMBOL cap 928 -432 R0
SYMATTR InstName C14
SYMATTR Value 68p
SYMBOL bv -928 640 R0
SYMATTR InstName B1
SYMATTR Value v=if(time>1e-6,{a}*sgn(v(sine)),0)
SYMBOL bv -768 160 R0
SYMATTR InstName B2
SYMATTR Value V=if({square}>0,v(sqr),v(sine))
SYMBOL npn 688 416 R0
SYMATTR InstName Q10
SYMATTR Value 2N5550
SYMBOL npn 544 336 R0
SYMATTR InstName Q13
SYMATTR Value 2N5550
SYMBOL res 736 544 R0
SYMATTR InstName R16
SYMATTR Value 22
SYMBOL res 592 496 R0
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL diode 480 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL pnp 688 -592 M180
SYMATTR InstName Q6
SYMATTR Value 2N5401
SYMBOL res 736 -848 R0
SYMATTR InstName R10
SYMATTR Value 47
SYMBOL pnp 608 -672 R180
SYMATTR InstName Q14
SYMATTR Value 2N5401
SYMBOL res 528 -608 R0
SYMATTR InstName R19
SYMATTR Value 10k
SYMBOL npn 160 352 R0
SYMATTR InstName Q8
SYMATTR Value 2N5550
SYMBOL npn 48 352 M0
SYMATTR InstName Q12
SYMATTR Value 2N5550
SYMBOL res -32 528 R0
SYMATTR InstName R13
SYMATTR Value 470
SYMBOL res 208 528 R0
SYMATTR InstName R14
SYMATTR Value 470
SYMBOL pnp 48 -592 M180
SYMATTR InstName Q3
SYMATTR Value 2N5401
SYMBOL res 96 -848 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL pnp -32 -672 R180
SYMATTR InstName Q4
SYMATTR Value 2N5401
SYMBOL res -112 -608 R0
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL res 224 -448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R24
SYMATTR Value 100
SYMBOL res 96 -448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 100
SYMBOL pnp 288 -128 R180
SYMATTR InstName Q1
SYMATTR Value BC557B
SYMBOL pnp -80 -128 M180
SYMATTR InstName Q2
SYMATTR Value BC557B
SYMBOL res 1024 -896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100
SYMBOL res 992 688 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 100
SYMBOL npn 560 576 M0
SYMATTR InstName Q11
SYMATTR Value 2N5550
SYMBOL res 1792 -448 R0
SYMATTR InstName R15
SYMATTR Value 0.33
SYMBOL res 1792 80 R0
SYMATTR InstName R22
SYMATTR Value 0.33
TEXT -352 800 Left 2 !.param f=1k a=2 square=0 sim_time=100m delay=100m\n.tran 0 {sim_time+delay} {delay} 100n\n.four {f} 50 -1 v(out)\n.option plotwinsize=0 NoOpiter numdgt=15
TEXT -344 752 Left 2 ;.ac dec 1000 1 10000k
TEXT -352 920 Left 2 ;.noise out in dec 1000 1 1meg
TEXT 2712 -280 Left 2 ;Notch filter for time domain distortion test
TEXT 344 792 Left 2 ;f - Input frequency\na - Input amplitude\nsquare - Set to non-zero for square wave input\nsim_time - Simulation time (not counting settling delay)\ndelay - Settling delay. Set to several seconds for accurate THD
